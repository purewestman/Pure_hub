<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pure Partner Pre-Sales Hub | Interactive Handbook</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Chosen Palette: Warm Corporate Tech 
         Primary: Orange (Pure Brand), Secondary: Slate/Gray, Background: Off-white/White
    -->

    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            /* Background Image Setup */
            background-color: #f8fafc; /* Fallback color */
            background-image: url('image_a31ce7.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }
        
        /* Custom Scrollbar for cleaner look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Chart Container Logic per requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Tailwind max-w-xl approx */
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        /* Animation utilities */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .nav-item.active {
            background-color: #fff7ed; /* orange-50 */
            color: #ea580c; /* orange-600 */
            border-left: 4px solid #ea580c;
        }

        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 8px;
            padding: 16px;
            position: fixed;
            z-index: 50;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 14px;
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        /* CSS Badges for Program Levels */
        .badge-elite {
            background: linear-gradient(135deg, #f97316 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(234, 88, 12, 0.3);
        }
        .badge-preferred {
            background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
            color: white;
        }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden">

    <!-- Application Structure Plan:
         1. Layout: Sidebar Navigation (Desktop) / Hamburger (Mobile) + Main Content Area.
         2. Dashboard: High-level metrics, quick tools, and search.
         3. Training & Certs: Program info, direct links, and Interactive Goal Tracker.
         4. Knowledge Base: Filterable list/grid of the technical links.
         5. Tools: Card grid for external tools.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <!-- Top Header -->
    <header class="bg-white border-b border-slate-200 h-16 flex items-center justify-between px-6 shadow-sm z-20">
        <div class="flex items-center gap-3">
            <div class="w-8 h-8 bg-orange-600 rounded flex items-center justify-center text-white font-bold text-xl">P</div>
            <h1 class="font-bold text-lg tracking-tight text-slate-900 hidden sm:block">Pure Partner <span class="text-orange-600">Hub</span></h1>
        </div>
        
        <div class="flex-1 max-w-xl mx-4">
            <div class="relative">
                <span class="absolute left-3 top-2.5 text-slate-400">üîç</span>
                <input type="text" id="globalSearch" placeholder="Search handbook (e.g., 'Sizing', 'FlashBlade', 'Ports')..." 
                    class="w-full pl-10 pr-4 py-2 bg-slate-100 border-none rounded-lg focus:ring-2 focus:ring-orange-500 focus:bg-white transition-all text-sm">
            </div>
        </div>

        <div class="text-xs text-slate-500 font-medium bg-slate-100 px-3 py-1 rounded-full">
            Dec 2025 Edition
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar Navigation -->
        <nav class="w-64 bg-white border-r border-slate-200 flex-col hidden md:flex z-10">
            <div class="p-4 space-y-1">
                <button onclick="router('dashboard')" id="nav-dashboard" class="nav-item active w-full text-left px-4 py-3 rounded-r-lg font-medium text-slate-600 hover:bg-slate-50 transition-colors flex items-center gap-3">
                    <span>üìä</span> Dashboard
                </button>
                <button onclick="router('training')" id="nav-training" class="nav-item w-full text-left px-4 py-3 rounded-r-lg font-medium text-slate-600 hover:bg-slate-50 transition-colors flex items-center gap-3">
                    <span>üéì</span> Training & Certs
                </button>
                <button onclick="router('library')" id="nav-library" class="nav-item w-full text-left px-4 py-3 rounded-r-lg font-medium text-slate-600 hover:bg-slate-50 transition-colors flex items-center gap-3">
                    <span>üìö</span> Technical Library
                </button>
                <button onclick="router('tools')" id="nav-tools" class="nav-item w-full text-left px-4 py-3 rounded-r-lg font-medium text-slate-600 hover:bg-slate-50 transition-colors flex items-center gap-3">
                    <span>üõ†Ô∏è</span> Tools & Apps
                </button>
            </div>
            
            <div class="mt-auto p-6 border-t border-slate-100">
                <div class="bg-blue-50 p-4 rounded-lg text-xs text-blue-800">
                    <strong class="block mb-1">Quick Tip:</strong>
                    Console Settings: <br>
                    <code class="bg-white px-1 rounded border border-blue-100">115200, 8-N-1</code>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main id="mainContent" class="flex-1 overflow-y-auto bg-slate-50/90 p-4 md:p-8 scroll-smooth">
            <!-- Content Injected via JS -->
        </main>
    </div>
    
    <!-- Toast Notification Element -->
    <div id="toast">Link copied to clipboard!</div>

    <script>
        // --- State Management ---
        const state = {
            currentView: 'dashboard',
            searchQuery: '',
            // Training Goals (UPDATED for Zone B - South Africa)
            userProgress: { sales: 2, tech: 1, bootcamp: 0, install: 1 },
            requirements: { sales: 5, tech: 3, bootcamp: 3, install: 5 } 
        };

        // --- Data Source (Extracted from Handbook) ---
        const handbookData = {
            quickLinks: [
                { title: "Partner Central", url: "https://purestorage.my.site.com/partners/s/", icon: "üè¢", desc: "Deal Reg & Marketing" },
                { title: "Support Portal", url: "https://support.purestorage.com/", icon: "üöë", desc: "Knowledge Base" },
                { title: "Test Drive", url: "https://testdrive.purestorage.com", icon: "üèéÔ∏è", desc: "Virtual Labs" },
                { title: "Sizing Tool", url: "https://purestorage.my.site.com/sales/s/tools", icon: "üìè", desc: "Capacity Planning" }
            ],
            library: [
                { category: "FlashArray (Block)", title: "Purity//FA Docs", url: "https://support.purestorage.com/FlashArray/PurityFA", tags: "admin, guide" },
                { category: "FlashArray (Block)", title: "Release Notes", url: "https://support.purestorage.com/bundle/m_flasharray_release/page/FlashArray/topics/concept/c_flasharray_release.html", tags: "updates, version" },
                { category: "FlashArray (Block)", title: "Hardware Docs (//X, //C, //XL)", url: "https://support.purestorage.com/FlashArray/FlashArray_Hardware", tags: "specs, shelves" },
                { category: "FlashArray (Block)", title: "Capacity & Limits", url: "https://support.purestorage.com/bundle/m_flasharray_limits/page/FlashArray/FlashArray_Capacity_and_Feature_Limits/topics/o_flasharray_limits.html", tags: "limits, max" },
                { category: "FlashArray (Block)", title: "Network Ports (TCP/UDP)", url: "https://support.purestorage.com/bundle/m_flasharray_connectivity/page/c_flasharray_tcp_and_udp_port_assignments.html", tags: "firewall, network" },
                { category: "FlashArray (File)", title: "File Services Main", url: "https://support.purestorage.com/FlashArray/PurityFA/FlashArray_File_Services", tags: "nfs, smb" },
                { category: "FlashArray (File)", title: "Support Matrix", url: "https://support.purestorage.com/bundle/m_flasharray_file_services/page/FlashArray/PurityFA/FlashArray_File_Services/Configuration/topics/topic/t_FA_File_-_Support_Matrix.html", tags: "compatibility" },
                { category: "FlashBlade", title: "Compatibility Matrix", url: "https://support.purestorage.com/bundle/m_getting_started_with_flashblade/page/FlashBlade/Getting_Started_with_FlashBlade/topics/concept/c_flashblade_compatibility_matrix.html", tags: "support" },
                { category: "FlashBlade", title: "Hardware Docs", url: "https://support.purestorage.com/FlashBlade/FlashBlade_Hardware", tags: "chassis, blade" },
                { category: "Replication", title: "ActiveCluster Overview", url: "https://support.purestorage.com/FlashArray/PurityFA/Replication/ActiveCluster/001_Overview", tags: "bcdr, metro" },
                { category: "Replication", title: "ActiveDR Best Practices", url: "https://support.purestorage.com/FlashArray/FlashArray_Release/FlashArray_Release_Information/library/common_content/c_activedr_installation_planning_and_best_practices_guide.html", tags: "dr, disaster recovery" },
                { category: "Integration", title: "VMware Platform Guide", url: "https://support.purestorage.com/Solutions/VMware_Platform_Guide", tags: "vsphere, esxi" },
                { category: "Integration", title: "Portworx Docs", url: "https://docs.portworx.com/", tags: "kubernetes, k8s" },
                { category: "Cloud", title: "Pure Cloud Block Store (AWS)", url: "https://www.purestorage.com/resources/type-a/pure-storage-cloud-block-store-aws-solution-overview.html", tags: "cbs, cloud" }
            ],
            tools: [
                { title: "Pure Test Drive", url: "https://testdrive.purestorage.com", desc: "On-demand virtual labs. FlashArray, FlashBlade, Veeam integration, and more. Labs expire after 2 hours (can be extended).", type: "Demo" },
                { title: "Sizing Tool", url: "https://purestorage.my.site.com/sales/s/tools", desc: "Calculate capacity, growth, and hardware requirements for FA and FB.", type: "Planning" },
                { title: "Rack Diagram Builder", url: "https://sile16.github.io/purerackdiagram/", desc: "Unofficial visualizer to build rack layouts for customer documentation.", type: "Design" },
                { title: "FlashArray 3D Tour", url: "https://apps.apple.com/us/app/pure-storage-flasharray-tour/id964925778", desc: "Interactive hardware demo app (iOS/Android).", type: "Mobile App" },
                { title: "Pure Code", url: "https://code.purestorage.com/", desc: "Scripts for Terraform, Ansible, Python, PowerShell.", type: "Dev" }
            ]
        };

        // --- Chart Instance (Global) ---
        let trainingChart = null;

        // --- Helper Functions (Defined First) ---

        function loadState() {
            // 1. Check URL Params (Sharing Priority)
            const params = new URLSearchParams(window.location.search);
            if (params.has('sales')) {
                state.userProgress.sales = parseInt(params.get('sales')) || 0;
                state.userProgress.tech = parseInt(params.get('tech')) || 0;
                state.userProgress.bootcamp = parseInt(params.get('bootcamp')) || 0;
                state.userProgress.install = parseInt(params.get('install')) || 0;
                // Clean URL
                window.history.replaceState({}, document.title, window.location.pathname);
                saveState(); // Save imported state to local
                showToast("Progress loaded from shared link!");
                return;
            }

            // 2. Check LocalStorage
            const saved = localStorage.getItem('pureHubProgress');
            if (saved) {
                try {
                    state.userProgress = JSON.parse(saved);
                    // Ensure backward compatibility if bootcamp wasn't saved before
                    if (state.userProgress.bootcamp === undefined) state.userProgress.bootcamp = 0;
                } catch(e) { console.error('Error loading state', e); }
            }
        }

        function saveState() {
            localStorage.setItem('pureHubProgress', JSON.stringify(state.userProgress));
        }

        function generateShareLink() {
            const url = new URL(window.location.href);
            url.searchParams.set('sales', state.userProgress.sales);
            url.searchParams.set('tech', state.userProgress.tech);
            url.searchParams.set('bootcamp', state.userProgress.bootcamp);
            url.searchParams.set('install', state.userProgress.install);
            
            const linkText = url.toString();
            
            // Create temporary textarea to facilitate copying
            const textArea = document.createElement("textarea");
            textArea.value = linkText;
            
            // Ensure it's not visible but part of DOM to allow selection
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            
            textArea.focus();
            textArea.select();
            
            try {
                // Execute legacy copy command which works better in iframes/sandboxes
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast("Shareable link copied to clipboard!");
                } else {
                    // Fallback to prompt if even execCommand fails
                    window.prompt("Copy this link to share:", linkText);
                }
            } catch (err) {
                console.error('Fallback copy failed', err);
                window.prompt("Copy this link to share:", linkText);
            }
            
            document.body.removeChild(textArea);
        }

        function showToast(msg) {
            const el = document.getElementById("toast");
            el.innerText = msg;
            el.className = "show";
            setTimeout(() => { el.className = el.className.replace("show", ""); }, 3000);
        }

        function updateProgress(type, delta) {
            const current = state.userProgress[type];
            const newVal = current + delta;
            if (newVal < 0) return;
            
            // Update State
            state.userProgress[type] = newVal;
            saveState(); // Save to local storage
            
            // Update UI Number
            const uiEl = document.getElementById(`val-${type}`);
            if(uiEl) uiEl.innerText = newVal;
            
            // Update Chart
            if (trainingChart) {
                // Dataset 0 is 'Your Progress'
                const indexMap = { 'sales': 0, 'tech': 1, 'bootcamp': 2, 'install': 3 };
                trainingChart.data.datasets[0].data[indexMap[type]] = newVal;
                trainingChart.update();
            }
        }

        // --- Chart Function (Defined before use) ---

        function initChart() {
            const ctx = document.getElementById('trainingChartCanvas');
            if (!ctx) return;

            // Destroy existing if any
            if (trainingChart) trainingChart.destroy();

            trainingChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Sales Accred.', 'Tech Accred.', 'SE Bootcamp', 'Installations'],
                    datasets: [
                        {
                            label: 'Your Progress',
                            data: [state.userProgress.sales, state.userProgress.tech, state.userProgress.bootcamp, state.userProgress.install],
                            backgroundColor: '#ea580c', // Orange 600
                            borderRadius: 4,
                        },
                        {
                            label: 'Elite Requirement',
                            data: [state.requirements.sales, state.requirements.tech, state.requirements.bootcamp, state.requirements.install],
                            backgroundColor: '#e2e8f0', // Slate 200
                            borderRadius: 4,
                            borderWidth: 1,
                            borderColor: '#cbd5e1'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 12, // slightly higher than max req (10)
                            grid: { color: '#f1f5f9' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(15, 23, 42, 0.9)', // Slate 900
                            titleFont: { family: 'Inter', size: 13 },
                            bodyFont: { family: 'Inter', size: 12 },
                            padding: 10,
                            cornerRadius: 4
                        }
                    }
                }
            });
        }

        // --- Render Functions (Defined before Router) ---

        function renderDashboard(container) {
            container.innerHTML = `
                <div class="fade-in max-w-5xl mx-auto space-y-8">
                    <!-- Hero -->
                    <div class="bg-gradient-to-r from-orange-600 to-orange-500 rounded-2xl p-8 text-white shadow-lg">
                        <h2 class="text-3xl font-bold mb-2">Welcome to the Partner Pre-Sales Hub</h2>
                        <p class="opacity-90 max-w-2xl text-lg">Your central access point for technical documentation, sizing tools, and certification tracking.</p>
                        <div class="mt-6 flex flex-wrap gap-2 text-sm opacity-80">
                            <span class="bg-white/20 px-3 py-1 rounded-full">Updated Dec 2025</span>
                            <span class="bg-white/20 px-3 py-1 rounded-full">Zone B Requirements (South Africa)</span>
                        </div>
                    </div>

                    <!-- Introduction Context -->
                    <div class="prose max-w-none text-slate-600">
                        <p>This interactive hub consolidates the <strong>Technical Handbook for Pure Partners</strong>. Use the navigation to track your Elite Partner certification progress, browse the technical library, or launch essential sales tools.</p>
                    </div>

                    <!-- Quick Links Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                        ${handbookData.quickLinks.map(link => `
                            <a href="${link.url}" target="_blank" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200 hover:border-orange-500 hover:shadow-md transition-all group">
                                <div class="text-3xl mb-3 group-hover:scale-110 transition-transform duration-200">${link.icon}</div>
                                <h3 class="font-bold text-slate-800">${link.title}</h3>
                                <p class="text-xs text-slate-500 mt-1">${link.desc}</p>
                            </a>
                        `).join('')}
                    </div>

                    <!-- Quick Reference Section -->
                    <div class="bg-white rounded-xl border border-slate-200 p-6 shadow-sm">
                        <h3 class="font-bold text-lg mb-4 text-slate-800 flex items-center gap-2">
                            <span>‚ö°</span> Quick Technical References
                        </h3>
                        <div class="bg-slate-50 p-6 rounded-lg w-full">
                            <h4 class="text-sm font-semibold text-slate-700 mb-4 uppercase tracking-wider">Recommended Training</h4>
                            <ul class="text-sm text-slate-600 space-y-3">
                                <li class="flex flex-col sm:flex-row sm:items-start gap-1">
                                    <div class="flex-shrink-0 w-2 h-2 mt-2 bg-orange-400 rounded-full mr-2 hidden sm:block"></div>
                                    <div>
                                        <a href="https://partneracademy.purestorage.com/student/path/1324329-pure-fundamentals" target="_blank" class="text-orange-600 font-semibold hover:underline">Pure Fundamentals</a>
                                        <span class="text-xs text-slate-500 bg-white border border-slate-200 px-1.5 py-0.5 rounded ml-2">1 hr</span>
                                        <div class="text-slate-500 text-xs mt-0.5">Storage Overview, Administration, Monitoring, Troubleshooting and Data Recovery.</div>
                                    </div>
                                </li>
                                <li class="flex flex-col sm:flex-row sm:items-start gap-1">
                                    <div class="flex-shrink-0 w-2 h-2 mt-2 bg-orange-400 rounded-full mr-2 hidden sm:block"></div>
                                    <div>
                                        <a href="https://partneracademy.purestorage.com/student/path/1307799-flasharray-foundations" target="_blank" class="text-orange-600 font-semibold hover:underline">FlashArray Foundations</a>
                                        <span class="text-xs text-slate-500 bg-white border border-slate-200 px-1.5 py-0.5 rounded ml-2">3 hrs</span>
                                        <div class="text-slate-500 text-xs mt-0.5">FlashArray Functionality, FlashArray Administration, ActiveCluster, Virtual Volumes.</div>
                                    </div>
                                </li>
                                <li class="flex flex-col sm:flex-row sm:items-start gap-1">
                                    <div class="flex-shrink-0 w-2 h-2 mt-2 bg-orange-400 rounded-full mr-2 hidden sm:block"></div>
                                    <div>
                                        <a href="https://partneracademy.purestorage.com/student/path/1324534-flashblade-foundations" target="_blank" class="text-orange-600 font-semibold hover:underline">FlashBlade Foundations</a>
                                        <span class="text-xs text-slate-500 bg-white border border-slate-200 px-1.5 py-0.5 rounded ml-2">2 hrs</span>
                                        <div class="text-slate-500 text-xs mt-0.5">Functionality, Administration, Analysis, Admin Tools, Technical Services.</div>
                                    </div>
                                </li>
                                <li class="flex flex-col sm:flex-row sm:items-start gap-1">
                                    <div class="flex-shrink-0 w-2 h-2 mt-2 bg-orange-400 rounded-full mr-2 hidden sm:block"></div>
                                    <div>
                                        <a href="https://partneracademy.purestorage.com/student/activity/2103461-pure-fusion-foundations" target="_blank" class="text-orange-600 font-semibold hover:underline">Pure Fusion Foundations</a>
                                        <span class="text-xs text-slate-500 bg-white border border-slate-200 px-1.5 py-0.5 rounded ml-2">30 mins</span>
                                        <div class="text-slate-500 text-xs mt-0.5">Overview, Concepts, How It Works, Messaging.</div>
                                    </div>
                                </li>
                                <li class="flex flex-col sm:flex-row sm:items-start gap-1">
                                    <div class="flex-shrink-0 w-2 h-2 mt-2 bg-orange-400 rounded-full mr-2 hidden sm:block"></div>
                                    <div>
                                        <a href="https://partneracademy.purestorage.com/student/catalog/list?category_ids=40388-pure1" target="_blank" class="text-orange-600 font-semibold hover:underline">Pure1 Demo Video</a>
                                        <span class="text-xs text-slate-500 bg-white border border-slate-200 px-1.5 py-0.5 rounded ml-2">17 mins</span>
                                    </div>
                                </li>
                                <li class="flex flex-col sm:flex-row sm:items-start gap-1">
                                    <div class="flex-shrink-0 w-2 h-2 mt-2 bg-orange-400 rounded-full mr-2 hidden sm:block"></div>
                                    <div>
                                        <a href="https://partneracademy.purestorage.com/student/path/1426789-portworx-technical-sales-professional" target="_blank" class="text-orange-600 font-semibold hover:underline">Portworx Technical Sales Professional Path</a>
                                        <div class="text-slate-500 text-xs mt-0.5">Curated list of courses. Note: ‚ÄúBeyond The Basics‚Äù are full courses in themselves.</div>
                                    </div>
                                </li>
                                <li class="flex flex-col sm:flex-row sm:items-start gap-1">
                                    <div class="flex-shrink-0 w-2 h-2 mt-2 bg-orange-400 rounded-full mr-2 hidden sm:block"></div>
                                    <div>
                                        <a href="https://partneracademy.purestorage.com/student/path/1481086-beyond-the-basics" target="_blank" class="text-orange-600 font-semibold hover:underline">Kubernetes / Portworx ‚Äì Beyond The Basics</a>
                                        <span class="text-xs text-slate-500 bg-white border border-slate-200 px-1.5 py-0.5 rounded ml-2">6 hrs</span>
                                        <div class="text-slate-500 text-xs mt-0.5">Two separate courses, one for Kubernetes, one for Portworx.</div>
                                    </div>
                                </li>
                                <li class="flex flex-col sm:flex-row sm:items-start gap-1">
                                    <div class="flex-shrink-0 w-2 h-2 mt-2 bg-orange-400 rounded-full mr-2 hidden sm:block"></div>
                                    <div>
                                        <a href="https://partneracademy.purestorage.com/student/collection/1364015/path/1929919/activity/1929892" target="_blank" class="text-orange-600 font-semibold hover:underline">Cloud Block Store</a>
                                        <span class="text-xs text-slate-500 bg-white border border-slate-200 px-1.5 py-0.5 rounded ml-2">3.7 hrs</span>
                                        <div class="text-slate-500 text-xs mt-0.5">Preparation course for the Cloud Block Store Specialist certification.</div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderTraining(container) {
            container.innerHTML = `
                <div class="fade-in max-w-5xl mx-auto space-y-8">
                    <div class="border-b border-slate-200 pb-4">
                        <h2 class="text-2xl font-bold text-slate-900">Training & Certifications</h2>
                        <p class="text-slate-500 mt-1">Manage your certification journey, access program resources, and track progress.</p>
                    </div>

                    <!-- 1. Partner Program Info Section -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Card 1: Program Levels -->
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <span>üèÜ</span> Program Levels
                            </h3>
                            <div class="space-y-4">
                                <!-- Preferred Badge -->
                                <div class="flex items-center gap-4 p-3 bg-slate-50 rounded-lg border border-slate-100">
                                    <div class="badge-preferred w-12 h-12 rounded-full flex items-center justify-center font-bold text-xs shadow-sm">
                                        PREF
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-slate-700">Preferred Partner</h4>
                                        <p class="text-xs text-slate-500">Entry level requirements. Focus on fundamentals.</p>
                                    </div>
                                </div>
                                <!-- Elite Badge -->
                                <div class="flex items-center gap-4 p-3 bg-orange-50 rounded-lg border border-orange-100">
                                    <div class="badge-elite w-12 h-12 rounded-full flex items-center justify-center font-bold text-xs shadow-md">
                                        ELITE
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-orange-800">Elite Partner</h4>
                                        <p class="text-xs text-orange-700">Advanced requirements. Higher incentives & rebates.</p>
                                    </div>
                                </div>
                                <div class="mt-4 pt-4 border-t border-slate-100">
                                    <a href="https://purestorage.my.site.com/partners/s/learn/program/reseller-program" target="_blank" class="text-sm text-orange-600 font-medium hover:text-orange-800 flex items-center gap-1">
                                        View Full Reseller Program Guide <span>‚Üó</span>
                                    </a>
                                </div>
                            </div>
                        </div>

                        <!-- Card 2: Quick Training Links -->
                        <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                            <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                                <span>üîó</span> Quick Access Training
                            </h3>
                            <ul class="space-y-3">
                                <li>
                                    <a href="https://purestorage.my.site.com/partners/s/learn/training-and-certification/program-training" target="_blank" class="block p-3 rounded bg-slate-50 hover:bg-orange-50 border border-slate-200 hover:border-orange-200 transition-colors">
                                        <div class="font-bold text-slate-800 text-sm">Program Training Portal</div>
                                        <div class="text-xs text-slate-500">Access required courses for compliance.</div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://partneracademy.purestorage.com/" target="_blank" class="block p-3 rounded bg-slate-50 hover:bg-orange-50 border border-slate-200 hover:border-orange-200 transition-colors">
                                        <div class="font-bold text-slate-800 text-sm">Partner Academy</div>
                                        <div class="text-xs text-slate-500">Full catalog of on-demand & instructor-led training.</div>
                                    </a>
                                </li>
                                <li>
                                    <a href="https://www.purestorage.com/services/certifications.html" target="_blank" class="block p-3 rounded bg-slate-50 hover:bg-orange-50 border border-slate-200 hover:border-orange-200 transition-colors">
                                        <div class="font-bold text-slate-800 text-sm">Certification Exams</div>
                                        <div class="text-xs text-slate-500">Schedule exams and view certification paths.</div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <!-- 2. Goal Tracker Section (Existing) -->
                    <div class="bg-slate-100 rounded-xl p-6 border border-slate-200 mt-8">
                        <div class="flex flex-col sm:flex-row justify-between items-start sm:items-end mb-6 gap-4">
                            <div>
                                <h3 class="text-xl font-bold text-slate-900">Elite Status Tracker (Zone B - South Africa)</h3>
                                <p class="text-slate-500 text-sm mt-1">Simulate your team's progress against Zone B requirements.</p>
                            </div>
                            <button onclick="generateShareLink()" class="bg-white border border-slate-300 text-slate-700 hover:bg-orange-50 hover:text-orange-700 hover:border-orange-300 px-4 py-2 rounded-lg font-medium transition-all shadow-sm text-sm flex items-center gap-2">
                                <span>üîó</span> Share Progress
                            </button>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            <!-- Controls -->
                            <div class="lg:col-span-1 bg-white p-6 rounded-xl border border-slate-200 shadow-sm h-fit">
                                <h4 class="font-bold text-sm text-slate-400 uppercase tracking-wider mb-4">Input Your Metrics</h4>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1">Sales Accreditations</label>
                                        <div class="flex items-center gap-3">
                                            <button onclick="updateProgress('sales', -1)" class="w-8 h-8 rounded bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold">-</button>
                                            <span id="val-sales" class="font-mono text-lg font-bold w-6 text-center">${state.userProgress.sales}</span>
                                            <button onclick="updateProgress('sales', 1)" class="w-8 h-8 rounded bg-orange-100 hover:bg-orange-200 text-orange-600 font-bold">+</button>
                                        </div>
                                        <p class="text-xs text-slate-400 mt-1">Target: ${state.requirements.sales}</p>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1">Tech Accreditations</label>
                                        <div class="flex items-center gap-3">
                                            <button onclick="updateProgress('tech', -1)" class="w-8 h-8 rounded bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold">-</button>
                                            <span id="val-tech" class="font-mono text-lg font-bold w-6 text-center">${state.userProgress.tech}</span>
                                            <button onclick="updateProgress('tech', 1)" class="w-8 h-8 rounded bg-orange-100 hover:bg-orange-200 text-orange-600 font-bold">+</button>
                                        </div>
                                        <p class="text-xs text-slate-400 mt-1">Target: ${state.requirements.tech}</p>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1">SE Bootcamp</label>
                                        <div class="flex items-center gap-3">
                                            <button onclick="updateProgress('bootcamp', -1)" class="w-8 h-8 rounded bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold">-</button>
                                            <span id="val-bootcamp" class="font-mono text-lg font-bold w-6 text-center">${state.userProgress.bootcamp}</span>
                                            <button onclick="updateProgress('bootcamp', 1)" class="w-8 h-8 rounded bg-orange-100 hover:bg-orange-200 text-orange-600 font-bold">+</button>
                                        </div>
                                        <p class="text-xs text-slate-400 mt-1">Target: ${state.requirements.bootcamp}</p>
                                    </div>
                                    <div>
                                        <label class="block text-xs font-semibold text-slate-500 uppercase mb-1">Installations</label>
                                        <div class="flex items-center gap-3">
                                            <button onclick="updateProgress('install', -1)" class="w-8 h-8 rounded bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold">-</button>
                                            <span id="val-install" class="font-mono text-lg font-bold w-6 text-center">${state.userProgress.install}</span>
                                            <button onclick="updateProgress('install', 1)" class="w-8 h-8 rounded bg-orange-100 hover:bg-orange-200 text-orange-600 font-bold">+</button>
                                        </div>
                                        <p class="text-xs text-slate-400 mt-1">Target: ${state.requirements.install}</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Visualization -->
                            <div class="lg:col-span-2 bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col justify-center">
                                <!-- Chart Container -->
                                <div class="chart-container">
                                    <canvas id="trainingChartCanvas"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            initChart();
        }

        function renderLibrary(isSearch = false, container = document.getElementById('mainContent')) {
            // If triggered by search, don't wipe container fully if it's already library, just inner grid
            // But for simplicity of this logic, we re-render full view.
            
            // Filter Data
            let data = handbookData.library;
            let title = "Technical Library";
            let subtitle = "Direct access to support documentation, release notes, and integration guides.";

            if (state.searchQuery) {
                const q = state.searchQuery;
                data = data.filter(item => 
                    item.title.toLowerCase().includes(q) || 
                    item.category.toLowerCase().includes(q) ||
                    item.tags.toLowerCase().includes(q)
                );
                title = `Search Results for "${q}"`;
                subtitle = `${data.length} resources found.`;
                state.currentView = 'library';
                
                // Update nav
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                document.getElementById('nav-library').classList.add('active');
            }

            // Grouping Logic
            const groups = {};
            data.forEach(item => {
                if (!groups[item.category]) groups[item.category] = [];
                groups[item.category].push(item);
            });

            // Flatten HTML generation to avoid deep nesting issues in template literals
            const groupsHtml = Object.keys(groups).map(category => {
                const itemsHtml = groups[category].map(item => `
                    <a href="${item.url}" target="_blank" class="block p-4 hover:bg-orange-50 transition-colors group">
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium text-slate-800 group-hover:text-orange-700">${item.title}</span>
                            <span class="text-slate-300 group-hover:text-orange-400">‚Üó</span>
                        </div>
                        <div class="mt-1 flex gap-2">
                            ${item.tags.split(',').map(tag => 
                                `<span class="text-[10px] uppercase tracking-wider text-slate-400 bg-slate-100 px-2 py-0.5 rounded-sm">${tag.trim()}</span>`
                            ).join('')}
                        </div>
                    </a>
                `).join('');

                return `
                    <div class="bg-white rounded-xl border border-slate-200 overflow-hidden shadow-sm">
                        <div class="bg-slate-50 px-6 py-3 border-b border-slate-200 flex items-center gap-2">
                            <span class="font-bold text-slate-700">${category}</span>
                        </div>
                        <div class="divide-y divide-slate-100">
                            ${itemsHtml}
                        </div>
                    </div>
                `;
            }).join('');

            container.innerHTML = `
                <div class="fade-in max-w-5xl mx-auto space-y-6">
                    <div class="border-b border-slate-200 pb-4">
                        <h2 class="text-2xl font-bold text-slate-900">${title}</h2>
                        <p class="text-slate-500 mt-1">${subtitle}</p>
                    </div>

                    ${Object.keys(groups).length === 0 ? 
                        `<div class="p-12 text-center text-slate-400">No documents found matching your search.</div>` 
                        : ''}

                    <div class="masonry-grid space-y-8">
                        ${groupsHtml}
                    </div>
                </div>
            `;
        }

        function renderTools(container) {
            container.innerHTML = `
                <div class="fade-in max-w-5xl mx-auto space-y-6">
                    <div class="border-b border-slate-200 pb-4">
                        <h2 class="text-2xl font-bold text-slate-900">Tools & Utilities</h2>
                        <p class="text-slate-500 mt-1">Essential applications for sizing, demonstrating, and designing solutions.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        ${handbookData.tools.map(tool => `
                            <div class="bg-white p-6 rounded-xl border border-slate-200 shadow-sm flex flex-col h-full hover:border-orange-400 transition-colors">
                                <div class="flex justify-between items-start mb-4">
                                    <h3 class="font-bold text-lg text-slate-900">${tool.title}</h3>
                                    <span class="px-2 py-1 bg-orange-100 text-orange-700 text-xs font-bold rounded uppercase">${tool.type}</span>
                                </div>
                                <p class="text-slate-600 text-sm mb-6 flex-grow">${tool.desc}</p>
                                <a href="${tool.url}" target="_blank" class="text-center w-full bg-slate-900 hover:bg-orange-600 text-white font-medium py-2 rounded-lg transition-colors">
                                    Launch Tool
                                </a>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // --- Router & Init (Defined Last) ---

        function router(viewName) {
            state.currentView = viewName;
            state.searchQuery = ''; // Clear search on nav
            const searchEl = document.getElementById('globalSearch');
            if(searchEl) searchEl.value = '';

            // Update Nav UI
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${viewName}`);
            if(activeNav) activeNav.classList.add('active');

            // Render View
            const main = document.getElementById('mainContent');
            main.innerHTML = ''; // Clear current
            
            // Mobile close (if we had a mobile menu, omitted for simplicity in this file)

            switch(viewName) {
                case 'dashboard': renderDashboard(main); break;
                case 'training': renderTraining(main); break;
                case 'library': renderLibrary(false, main); break;
                case 'tools': renderTools(main); break;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadState(); // Load from LocalStorage or URL
            router('dashboard'); // Initial load
            
            // Search Listener
            const searchEl = document.getElementById('globalSearch');
            if (searchEl) {
                searchEl.addEventListener('input', (e) => {
                    state.searchQuery = e.target.value.toLowerCase();
                    if (state.searchQuery.length > 0) {
                        renderLibrary(true); // Switch to library view filtered
                    } else {
                        if (state.currentView === 'library') renderLibrary(); // Clear filter
                    }
                });
            }
        });

    </script>
</body>
</html>
